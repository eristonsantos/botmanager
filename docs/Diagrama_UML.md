# ðŸ“Š Arquitetura Fase 5A - Diagramas

## 1ï¸âƒ£ Modelo de Dados (ER Diagram)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         TENANT              â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (UUID)                   â”‚
â”‚ name                        â”‚
â”‚ slug                        â”‚
â”‚ is_active                   â”‚
â”‚ settings (JSON)             â”‚
â”‚ created_at                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ 1:N
          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        PROCESSO             â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (UUID)                   â”‚
â”‚ tenant_id (FK)              â”‚
â”‚ name                        â”‚
â”‚ description                 â”‚
â”‚ tipo (enum)                 â”‚
â”‚ tags (JSON[])               â”‚
â”‚ is_active                   â”‚
â”‚ extra_data (JSON)           â”‚
â”‚ created_at                  â”‚
â”‚ updated_at                  â”‚
â”‚ deleted_at (soft delete)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ 1:N (cascade)
          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    VERSAO_PROCESSO          â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (UUID)                   â”‚
â”‚ tenant_id (FK)              â”‚
â”‚ processo_id (FK)            â”‚
â”‚ version (X.Y.Z)             â”‚
â”‚ package_path                â”‚
â”‚ is_active                   â”‚
â”‚ release_notes               â”‚
â”‚ config (JSON)               â”‚
â”‚ created_at                  â”‚
â”‚ updated_at                  â”‚
â”‚ deleted_at (soft delete)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CONSTRAINTS:
- processo.name UNIQUE per tenant
- versao_processo.version UNIQUE per processo
- versao_processo.is_active MAX 1 per processo
- All deleted_at queries filtered out
```

---

## 2ï¸âƒ£ Fluxo de RequisiÃ§Ã£o (Request Flow)

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  CLIENT REQUEST  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  HTTP + JWT      â”‚
                    â”‚  Authorization   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ CorrelationID     â”‚
                    â”‚ RequestLogging    â”‚
                    â”‚ RateLimit         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   ENDPOINT (FastAPI)        â”‚
              â”‚   â”œâ”€ Pydantic Validation    â”‚
              â”‚   â”œâ”€ Dependency Injection   â”‚
              â”‚   â””â”€ get_current_tenant_id()â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   SERVICE LAYER             â”‚
              â”‚   ProcessService            â”‚
              â”‚   â”œâ”€ list_processes()       â”‚
              â”‚   â”œâ”€ create_process()       â”‚
              â”‚   â”œâ”€ activate_version()     â”‚
              â”‚   â””â”€ ... (11 mÃ©todos)       â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   DATABASE LAYER             â”‚
              â”‚   SQLModel + SQLAlchemy      â”‚
              â”‚   â”œâ”€ SELECT + WHERE + FILTER â”‚
              â”‚   â”œâ”€ INSERT + COMMIT         â”‚
              â”‚   â”œâ”€ UPDATE + TRANSACTION    â”‚
              â”‚   â””â”€ Soft Delete             â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  PostgreSQL DATABASE        â”‚
              â”‚  â”œâ”€ processo table          â”‚
              â”‚  â”œâ”€ versao_processo table   â”‚
              â”‚  â”œâ”€ Indices                 â”‚
              â”‚  â””â”€ Constraints             â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Response Mapping â”‚
                    â”‚ ProcessRead      â”‚
                    â”‚ VersaoRead       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   JSON Response   â”‚
                    â”‚   + Status Code   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  RequestLogging     â”‚
                    â”‚  CorrelationID      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  CLIENT RESPONSE  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3ï¸âƒ£ Fluxo de AtivaÃ§Ã£o de VersÃ£o (TransaÃ§Ã£o AtÃ´mica)

```
PUT /processes/{id}/versions/{vid}/activate
                    â”‚
                    â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ activate_version(tenant_id, p_id,   â”‚
     â”‚                   v_id)             â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Validar processo â”‚
         â”‚ EXISTS           â”‚
         â”‚ tenant_id OK     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Validar versÃ£o    â”‚
         â”‚ EXISTS            â”‚
         â”‚ processo_id OK    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  BEGIN NESTED TRANSACTION   â”‚
    â”‚                             â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚  â”‚ Query versÃ£o anteriorâ”‚   â”‚
    â”‚  â”‚ WHERE is_active=True â”‚   â”‚
    â”‚  â”‚ AND processo_id={p}  â”‚   â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚             â”‚               â”‚
    â”‚       â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”        â”‚
    â”‚       â”‚ SE EXISTE  â”‚        â”‚
    â”‚       â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜        â”‚
    â”‚             â”‚               â”‚
    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
    â”‚    â”‚ UPDATE versÃ£o    â”‚     â”‚
    â”‚    â”‚ SET is_active    â”‚     â”‚
    â”‚    â”‚ = FALSE          â”‚     â”‚
    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
    â”‚             â”‚               â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
    â”‚  â”‚ UPDATE nova versÃ£o  â”‚    â”‚
    â”‚  â”‚ SET is_active=TRUE  â”‚    â”‚
    â”‚  â”‚ WHERE id={vid}      â”‚    â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
    â”‚             â”‚               â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
    â”‚  â”‚ COMMIT TRANSACTION  â”‚    â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
    â”‚             â”‚               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Log success         â”‚
         â”‚ "Version activated" â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Return ActivateResponseâ”‚
         â”‚ version: X.Y.Z        â”‚
         â”‚ is_active: true       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
         JSON + 200 OK

ERROR HANDLING:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Exception durante transaÃ§Ã£o
    â”‚
    â–¼
ROLLBACK automÃ¡tico
    â”‚
    â–¼
Log error
    â”‚
    â–¼
Raise exception
    â”‚
    â–¼
Error handler â†’ 500 ou 400
```

---

## 4ï¸âƒ£ Stack de Camadas

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           APRESENTAÃ‡ÃƒO (API)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ FastAPI Router                         â”‚  â”‚
â”‚  â”‚ â”œâ”€ GET /processes                      â”‚  â”‚
â”‚  â”‚ â”œâ”€ POST /processes                     â”‚  â”‚
â”‚  â”‚ â”œâ”€ GET /processes/{id}/versions        â”‚  â”‚
â”‚  â”‚ â””â”€ PUT /.../versions/{vid}/activate    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      VALIDAÃ‡ÃƒO E ESQUEMAS (Pydantic)         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ProcessCreate, ProcessRead, etc        â”‚  â”‚
â”‚  â”‚ â”œâ”€ Field validators                    â”‚  â”‚
â”‚  â”‚ â”œâ”€ Type checking                       â”‚  â”‚
â”‚  â”‚ â””â”€ Model conversions                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         LÃ“GICA DE NEGÃ“CIO (Service)          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ProcessService                         â”‚  â”‚
â”‚  â”‚ â”œâ”€ list_processes()                    â”‚  â”‚
â”‚  â”‚ â”œâ”€ create_process()                    â”‚  â”‚
â”‚  â”‚ â”œâ”€ activate_version() [TRANSATION]     â”‚  â”‚
â”‚  â”‚ â””â”€ ... (11 mÃ©todos)                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ACESSO A DADOS (ORM)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ SQLModel + SQLAlchemy                  â”‚  â”‚
â”‚  â”‚ â”œâ”€ Queries assÃ­ncronas                 â”‚  â”‚
â”‚  â”‚ â”œâ”€ Lazy loading (selectin)             â”‚  â”‚
â”‚  â”‚ â”œâ”€ Transactions                        â”‚  â”‚
â”‚  â”‚ â””â”€ Soft delete filters                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      BANCO DE DADOS (PostgreSQL)             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Tabelas                                â”‚  â”‚
â”‚  â”‚ â”œâ”€ processo (15 colunas)               â”‚  â”‚
â”‚  â”‚ â”œâ”€ versao_processo (12 colunas)        â”‚  â”‚
â”‚  â”‚ â””â”€ tenant (relacionamento)             â”‚  â”‚
â”‚  â”‚                                        â”‚  â”‚
â”‚  â”‚ Ãndices                                â”‚  â”‚
â”‚  â”‚ â”œâ”€ idx_processo_tenant_name            â”‚  â”‚
â”‚  â”‚ â”œâ”€ idx_versao_tenant_processo_version  â”‚  â”‚
â”‚  â”‚ â””â”€ ... (8 Ã­ndices)                     â”‚  â”‚
â”‚  â”‚                                        â”‚  â”‚
â”‚  â”‚ Constraints                            â”‚  â”‚
â”‚  â”‚ â”œâ”€ FOREIGN KEY (tenant)                â”‚  â”‚
â”‚  â”‚ â”œâ”€ UNIQUE (name per tenant)            â”‚  â”‚
â”‚  â”‚ â””â”€ CHECK (semver format)               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5ï¸âƒ£ Fluxo de Filtros (Tags ANY/ALL)

```
GET /processes?tags=financeiro,mensal&tag_match=any

                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Validar tag_match     â”‚
        â”‚ (ANY ou ALL)          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Se tag_match == ANY              â”‚
        â”‚   â”œâ”€ Processos COM financeiro    â”‚
        â”‚   â”‚ OR                           â”‚
        â”‚   â””â”€ Processos COM mensal        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Se tag_match == ALL                â”‚
        â”‚   â”œâ”€ Processos COM financeiro     â”‚
        â”‚   â”‚ AND                           â”‚
        â”‚   â””â”€ Processos COM mensal         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ WHERE                       â”‚
        â”‚ tags @> 'financeiro'        â”‚
        â”‚ [OR/AND]                    â”‚
        â”‚ tags @> 'mensal'            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Executar query no PostgreSQL â”‚
        â”‚ (JSONB operators)            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Retornar processos filtrados   â”‚
        â”‚ + total count                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        PaginatedResponse[ProcessRead]
```

---

## 6ï¸âƒ£ Multi-Tenancy AutomÃ¡tica

```
JWT Token
â”‚
â”œâ”€ header: { "alg": "HS256", "typ": "JWT" }
â”‚
â”œâ”€ payload: {
â”‚    "sub": "user-uuid",          â† user_id
â”‚    "tenant_id": "tenant-uuid",  â† TENANT!
â”‚    "exp": 1702738400,
â”‚    "type": "access"
â”‚  }
â”‚
â””â”€ signature: ...
        â”‚
        â–¼
get_current_tenant_id()
(extrai do JWT)
        â”‚
        â–¼
dependency_injection em endpoint
        â”‚
        â–¼
ProcessService.list_processes(
    tenant_id,  â† Automaticamente isolado
    filters
)
        â”‚
        â–¼
SELECT FROM processo
WHERE tenant_id = ? â† AUTOMÃTICO
  AND deleted_at IS NULL
        â”‚
        â–¼
Apenas dados do tenant retornados

âœ… Isolamento garantido em TODA query
âœ… Sem possibilidade de cross-tenant leak
âœ… Sem parametrizaÃ§Ã£o necessÃ¡ria
```

---

## 7ï¸âƒ£ Ãndices de Performance

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘          ÃNDICES CRIADOS (core.py)              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PROCESSO:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. idx_processo_tenant_name (tenant_id, name) UNIQUE
   â””â”€ Previne duplicaÃ§Ã£o, busca rÃ¡pida por nome

2. idx_processo_tenant_active (tenant_id, is_active)
   â””â”€ Filtro por status rÃ¡pido

VERSAO_PROCESSO:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
3. idx_versao_tenant_processo_version 
   (tenant_id, processo_id, version) UNIQUE
   â””â”€ Previne duplicaÃ§Ã£o, busca por versÃ£o

4. idx_versao_processo_active (processo_id, is_active)
   â””â”€ Encontra versÃ£o ativa rapidamente

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   QUERIES COM ESTAS INDICES SÃƒO RÃPIDAS        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

RÃPIDA (com Ã­ndice):
  SELECT * FROM processo 
  WHERE tenant_id = ? AND name = ?
  â”œâ”€ Index scan: idx_processo_tenant_name
  â””â”€ Tempo: O(log n)

LENTA (sem Ã­ndice):
  SELECT * FROM processo
  WHERE tags @> 'financeiro'
  â”œâ”€ Full table scan (JSONB Ã© complexo)
  â””â”€ Tempo: O(n) mas otimizado

TRANSAÃ‡ÃƒO RÃPIDA:
  BEGIN NESTED;
  UPDATE versao_processo SET is_active=FALSE
  WHERE processo_id=? AND is_active=TRUE
  â”œâ”€ Index: idx_versao_processo_active
  â””â”€ Tempo: O(1) + UPDATE
  
  UPDATE versao_processo SET is_active=TRUE
  WHERE id=?
  â””â”€ Index: PK
  â””â”€ Tempo: O(1) + UPDATE
  COMMIT;
```

---

## 8ï¸âƒ£ Exemplo Completo: POST /processes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/v1/processes                      â”‚
â”‚ Authorization: Bearer {JWT_TOKEN}           â”‚
â”‚                                             â”‚
â”‚ {                                           â”‚
â”‚   "name": "invoice_processing",             â”‚
â”‚   "tipo": "unattended",                     â”‚
â”‚   "tags": ["financeiro", "critico"]         â”‚
â”‚ }                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ [MIDDLEWARE]            â”‚
     â”‚ â”œâ”€ CorrelationID: gen() â”‚
     â”‚ â”œâ”€ JWT auth: decode     â”‚
     â”‚ â””â”€ Tenant: extract      â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ tenant_id="abc-123"
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ [ENDPOINT]                     â”‚
     â”‚ create_process(               â”‚
     â”‚   data: ProcessCreate,         â”‚
     â”‚   tenant_id: UUID,             â”‚
     â”‚   session: AsyncSession        â”‚
     â”‚ )                              â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ [VALIDATION]                     â”‚
     â”‚ â”œâ”€ name: str (3-100)             â”‚
     â”‚ â”œâ”€ tipo: TipoProcessoEnum OK?    â”‚
     â”‚ â”œâ”€ tags: valid? (max 20)         â”‚
     â”‚ â””â”€ extra_data: dict OK?          â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ [SERVICE LOGIC]                    â”‚
     â”‚ ProcessService.create_process(     â”‚
     â”‚   tenant_id="abc-123",             â”‚
     â”‚   data=ProcessCreate(...)          â”‚
     â”‚ )                                  â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ [DUPLICATE CHECK]                    â”‚
     â”‚ SELECT * FROM processo               â”‚
     â”‚ WHERE tenant_id='abc-123'             â”‚
     â”‚   AND name='invoice_processing'      â”‚
     â”‚   AND deleted_at IS NULL             â”‚
     â”‚                                      â”‚
     â”‚ âœ… NÃ£o encontrado â†’ prosseguir      â”‚
     â”‚ âŒ Encontrado â†’ ConflictError(409)   â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ [CREATE]                            â”‚
     â”‚ processo = Processo(                â”‚
     â”‚   id=uuid4(),                       â”‚
     â”‚   tenant_id="abc-123",              â”‚
     â”‚   name="invoice_processing",        â”‚
     â”‚   tipo=TipoProcessoEnum.UNATTENDED, â”‚
     â”‚   tags=["financeiro","critico"],    â”‚
     â”‚   is_active=True,                   â”‚
     â”‚   created_at=now(),                 â”‚
     â”‚   deleted_at=None                   â”‚
     â”‚ )                                   â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ [INSERT TO DB]                   â”‚
     â”‚ session.add(processo)            â”‚
     â”‚ await session.commit()           â”‚
     â”‚ await session.refresh(processo)  â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ [LOG]                        â”‚
     â”‚ "Process created: {id}"      â”‚
     â”‚ (com correlation_id)         â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ [AGGREGATE FIELDS]                â”‚
     â”‚ total_versions = 0 (novo)         â”‚
     â”‚ active_version = None (novo)      â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ [RESPONSE MAPPING]             â”‚
     â”‚ ProcessRead(                   â”‚
     â”‚   id="uuid-123",               â”‚
     â”‚   tenant_id="abc-123",         â”‚
     â”‚   name="invoice_processing",   â”‚
     â”‚   tipo="unattended",           â”‚
     â”‚   tags=["financeiro","critico"]â”‚
     â”‚   total_versions=0,            â”‚
     â”‚   active_version=None,         â”‚
     â”‚   created_at=now(),            â”‚
     â”‚   updated_at=now(),            â”‚
     â”‚   deleted_at=None              â”‚
     â”‚ )                              â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ [JSON RESPONSE]                 â”‚
     â”‚ 201 Created                     â”‚
     â”‚                                 â”‚
     â”‚ {                               â”‚
     â”‚   "id": "uuid-123",             â”‚
     â”‚   "tenant_id": "abc-123",       â”‚
     â”‚   "name": "invoice_processing", â”‚
     â”‚   "tipo": "unattended",         â”‚
     â”‚   "tags": [...],                â”‚
     â”‚   "total_versions": 0,          â”‚
     â”‚   "active_version": null,       â”‚
     â”‚   "created_at": "2024-12-16...", â”‚
     â”‚   ...                           â”‚
     â”‚ }                               â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ [RESPONSE MIDDLEWARE]        â”‚
     â”‚ â”œâ”€ Add correlation_id header â”‚
     â”‚ â”œâ”€ Log response              â”‚
     â”‚ â””â”€ Return to client          â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸŽ¯ Resumo Arquitetural

```
        CAMADAS                    VALIDAÃ‡ÃƒO                DADOS
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€               â”€â”€â”€â”€â”€â”€
        
        API Layer         â”€â”€â”€â”€>   Pydantic           â”€â”€>  Tenants
        â”œâ”€ GET            â”‚       â”œâ”€ Type checking        (n)
        â”œâ”€ POST           â”‚       â”œâ”€ Field validators         â”‚
        â”œâ”€ PUT            â”‚       â””â”€ Custom rules             â”‚
        â””â”€ DELETE         â”‚                                   â”œâ”€â”€> Processos
                          â”‚                                   â”‚    (n:1)
        Service Layer     â”‚                                   â”‚
        â”œâ”€ List           â”‚                                   â”œâ”€â”€> VersÃµes
        â”œâ”€ Create         â”€â”€â”€â”€>   Business Logic      â”€â”€>    â”‚    (1:n)
        â”œâ”€ Update         â”‚       â”œâ”€ Duplicates             â”‚
        â”œâ”€ Delete         â”‚       â”œâ”€ Transactions          â”‚
        â”œâ”€ Activate       â”‚       â””â”€ Aggregations          â”‚
        â””â”€ ...            â”‚                                   â”‚
                          â”‚                                   â”‚
        Data Layer        â”‚       ORM Mapping         â”€â”€>  PostgreSQL
        â”œâ”€ Query          â”€â”€â”€â”€>   â”œâ”€ SQLModel        â”‚    â”œâ”€ Tables
        â”œâ”€ Insert         â”‚       â”œâ”€ Relationships  â”‚    â”œâ”€ Indexes
        â”œâ”€ Update         â”‚       â””â”€ Soft Delete    â”‚    â””â”€ Constraints
        â””â”€ Transaction    â”‚                             â”‚

        Security          â”‚    JWT Token            â”€â”€>  Auth
        â”œâ”€ Tenant ID      â”€â”€â”€â”€>   â”œâ”€ Extract Payload     â”œâ”€ Extract
        â”œâ”€ User ID        â”‚       â”œâ”€ Validate Expiry     â”œâ”€ Validate
        â””â”€ Permissions    â”‚       â””â”€ Verify Signature    â””â”€ Authorize
```

**FIM DOS DIAGRAMAS**

---

Use este documento como referÃªncia visual para entender a arquitetura completa.